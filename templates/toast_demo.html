{% extends "base.html" %}

{% block title %}Toast & Confirmation Demo - Zillow Property Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-bell"></i> Toast & Confirmation Dialog Demo
        </h1>
        <p class="lead">Interactive demonstration of all toast notification and confirmation dialog features.</p>
    </div>
</div>

<!-- Basic Toast Examples -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-bell"></i> Basic Toast Notifications
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-success w-100" onclick="showSuccessToast('This is a success toast notification!')">
                            <i class="fas fa-check-circle"></i> Success Toast
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-danger w-100" onclick="showErrorToast('This is an error toast notification!')">
                            <i class="fas fa-exclamation-triangle"></i> Error Toast
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-warning w-100" onclick="showWarningToast('This is a warning toast notification!')">
                            <i class="fas fa-exclamation-circle"></i> Warning Toast
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-info w-100" onclick="showInfoToast('This is an info toast notification!')">
                            <i class="fas fa-info-circle"></i> Info Toast
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Dialog Examples -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-question-circle"></i> Confirmation Dialogs
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-primary w-100" onclick="demoBasicConfirm()">
                            <i class="fas fa-question"></i> Basic Confirm
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-danger w-100" onclick="demoDeleteConfirm()">
                            <i class="fas fa-trash"></i> Delete Confirm
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-warning w-100" onclick="demoUpdateConfirm()">
                            <i class="fas fa-edit"></i> Update Confirm
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-info w-100" onclick="demoActionConfirm()">
                            <i class="fas fa-cog"></i> Action Confirm
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Progress Toast Examples -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-spinner"></i> Progress Toast Examples
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-success w-100" onclick="demoProgressToast()">
                            <i class="fas fa-play"></i> Progress Toast
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-info w-100" onclick="demoProgressToastWithSteps()">
                            <i class="fas fa-list-ol"></i> Multi-Step Progress
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-warning w-100" onclick="demoProgressToastError()">
                            <i class="fas fa-exclamation-triangle"></i> Progress with Error
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast with Actions Examples -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-mouse-pointer"></i> Toast with Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-primary w-100" onclick="demoToastWithActions()">
                            <i class="fas fa-download"></i> Download Toast
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-success w-100" onclick="demoToastWithMultipleActions()">
                            <i class="fas fa-tasks"></i> Multiple Actions
                        </button>
                    </div>
                    <div class="col-md-4 mb-2">
                        <button class="btn btn-outline-info w-100" onclick="demoToastWithCustomActions()">
                            <i class="fas fa-magic"></i> Custom Actions
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Real-world Examples -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-rocket"></i> Real-world Scenarios
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-primary w-100" onclick="demoScraperWorkflow()">
                            <i class="fas fa-spider"></i> Scraper Workflow
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-success w-100" onclick="demoExportWorkflow()">
                            <i class="fas fa-file-export"></i> Export Workflow
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-warning w-100" onclick="demoBulkActionWorkflow()">
                            <i class="fas fa-tasks"></i> Bulk Actions
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-info w-100" onclick="demoErrorHandlingWorkflow()">
                            <i class="fas fa-bug"></i> Error Handling
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Configuration -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-cog"></i> Toast Configuration
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="customMessage" class="form-label">Custom Message</label>
                            <input type="text" class="form-control" id="customMessage" value="This is a custom toast message">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="customDuration" class="form-label">Duration (ms)</label>
                            <input type="number" class="form-control" id="customDuration" value="5000" min="1000" max="30000">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-outline-primary" onclick="showCustomToast()">
                            <i class="fas fa-paper-plane"></i> Show Custom Toast
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast History -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-history"></i> Toast History
                </h5>
            </div>
            <div class="card-body">
                <div id="toastHistory" class="border rounded p-3 bg-light" style="max-height: 200px; overflow-y: auto;">
                    <p class="text-muted mb-0">Toast notifications will appear here...</p>
                </div>
                <button class="btn btn-outline-secondary btn-sm mt-2" onclick="clearToastHistory()">
                    <i class="fas fa-trash"></i> Clear History
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let toastHistory = [];

// Add to history
function addToHistory(message, type) {
    const timestamp = new Date().toLocaleTimeString();
    const historyItem = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
    toastHistory.unshift(historyItem);
    
    // Keep only last 20 items
    if (toastHistory.length > 20) {
        toastHistory = toastHistory.slice(0, 20);
    }
    
    updateHistoryDisplay();
}

function updateHistoryDisplay() {
    const historyDiv = document.getElementById('toastHistory');
    if (toastHistory.length === 0) {
        historyDiv.innerHTML = '<p class="text-muted mb-0">Toast notifications will appear here...</p>';
    } else {
        historyDiv.innerHTML = toastHistory.map(item => `<div class="mb-1">${item}</div>`).join('');
    }
}

function clearToastHistory() {
    toastHistory = [];
    updateHistoryDisplay();
    showInfoToast('Toast history cleared');
}

// Demo functions
function demoBasicConfirm() {
    showConfirmDialog(
        'This is a basic confirmation dialog. Do you want to proceed?',
        'Basic Confirmation',
        'Proceed',
        'Cancel',
        'primary'
    ).then(confirmed => {
        if (confirmed) {
            showSuccessToast('You confirmed the action!');
            addToHistory('Basic confirmation confirmed', 'success');
        } else {
            showInfoToast('Action was cancelled');
            addToHistory('Basic confirmation cancelled', 'info');
        }
    });
}

function demoDeleteConfirm() {
    showDeleteConfirm('This is a delete confirmation dialog. Are you sure you want to delete this item?', 'item')
    .then(confirmed => {
        if (confirmed) {
            showSuccessToast('Item deleted successfully!');
            addToHistory('Delete confirmation confirmed', 'success');
        } else {
            showInfoToast('Delete action was cancelled');
            addToHistory('Delete confirmation cancelled', 'info');
        }
    });
}

function demoUpdateConfirm() {
    showUpdateConfirm('This is an update confirmation dialog. Do you want to update this item?', 'item')
    .then(confirmed => {
        if (confirmed) {
            showSuccessToast('Item updated successfully!');
            addToHistory('Update confirmation confirmed', 'success');
        } else {
            showInfoToast('Update action was cancelled');
            addToHistory('Update confirmation cancelled', 'info');
        }
    });
}

function demoActionConfirm() {
    showActionConfirm(
        'This is a custom action confirmation dialog. Do you want to perform this action?',
        'Custom Action',
        'Perform Action'
    ).then(confirmed => {
        if (confirmed) {
            showSuccessToast('Custom action performed successfully!');
            addToHistory('Custom action confirmed', 'success');
        } else {
            showInfoToast('Custom action was cancelled');
            addToHistory('Custom action cancelled', 'info');
        }
    });
}

function demoProgressToast() {
    const progressToast = showProgressToast('Processing your request...');
    
    let progress = 0;
    const interval = setInterval(() => {
        progress += 10;
        progressToast.updateProgress(progress);
        
        if (progress >= 100) {
            clearInterval(interval);
            progressToast.complete('Request completed successfully!', 'success');
            addToHistory('Progress toast completed', 'success');
        }
    }, 200);
}

function demoProgressToastWithSteps() {
    const progressToast = showProgressToast('Starting multi-step process...');
    
    setTimeout(() => {
        progressToast.updateMessage('Step 1: Initializing...');
        progressToast.updateProgress(20);
    }, 1000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 2: Processing data...');
        progressToast.updateProgress(40);
    }, 2000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 3: Validating results...');
        progressToast.updateProgress(60);
    }, 3000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 4: Finalizing...');
        progressToast.updateProgress(80);
    }, 4000);
    
    setTimeout(() => {
        progressToast.complete('Multi-step process completed successfully!', 'success');
        addToHistory('Multi-step progress completed', 'success');
    }, 5000);
}

function demoProgressToastError() {
    const progressToast = showProgressToast('Starting process that will fail...');
    
    setTimeout(() => {
        progressToast.updateMessage('Step 1: Initializing...');
        progressToast.updateProgress(25);
    }, 1000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 2: Processing...');
        progressToast.updateProgress(50);
    }, 2000);
    
    setTimeout(() => {
        progressToast.complete('Process failed due to an error!', 'error');
        addToHistory('Progress toast failed', 'error');
    }, 3000);
}

function demoToastWithActions() {
    showToastWithAction(
        'File downloaded successfully! You can now open it or save it to your preferred location.',
        'success',
        [
            {
                text: 'Open File',
                type: 'primary',
                onclick: 'showSuccessToast("Opening file...")'
            },
            {
                text: 'Save As...',
                type: 'outline-primary',
                onclick: 'showInfoToast("Save as dialog opened")'
            }
        ]
    );
    addToHistory('Toast with actions shown', 'info');
}

function demoToastWithMultipleActions() {
    showToastWithAction(
        'Bulk operation completed! 150 items were processed successfully.',
        'success',
        [
            {
                text: 'View Results',
                type: 'success',
                onclick: 'showSuccessToast("Opening results page...")'
            },
            {
                text: 'Export Data',
                type: 'info',
                onclick: 'showInfoToast("Starting export...")'
            },
            {
                text: 'Dismiss',
                type: 'secondary',
                onclick: 'showInfoToast("Toast dismissed")'
            }
        ]
    );
    addToHistory('Toast with multiple actions shown', 'info');
}

function demoToastWithCustomActions() {
    showToastWithAction(
        'Custom action completed! Choose your next step.',
        'info',
        [
            {
                text: 'Continue',
                type: 'success',
                onclick: 'showSuccessToast("Continuing to next step...")'
            },
            {
                text: 'Review',
                type: 'warning',
                onclick: 'showWarningToast("Opening review panel...")'
            }
        ]
    );
    addToHistory('Custom action toast shown', 'info');
}

function demoScraperWorkflow() {
    const progressToast = showProgressToast('Starting property scraper...');
    
    setTimeout(() => {
        progressToast.updateMessage('Step 1: Loading search configurations...');
        progressToast.updateProgress(20);
    }, 1000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 2: Connecting to Zillow...');
        progressToast.updateProgress(40);
    }, 2000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 3: Scraping property data...');
        progressToast.updateProgress(60);
    }, 3000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 4: Processing results...');
        progressToast.updateProgress(80);
    }, 4000);
    
    setTimeout(() => {
        progressToast.complete('Scraper completed successfully! Found 45 new properties.', 'success');
        
        // Show toast with actions
        setTimeout(() => {
            showToastWithAction(
                'Scraper found 45 new properties! What would you like to do next?',
                'success',
                [
                    {
                        text: 'View Properties',
                        type: 'primary',
                        onclick: 'showSuccessToast("Opening properties page...")'
                    },
                    {
                        text: 'Export CSV',
                        type: 'success',
                        onclick: 'showInfoToast("Starting CSV export...")'
                    }
                ]
            );
        }, 1000);
        
        addToHistory('Scraper workflow completed', 'success');
    }, 5000);
}

function demoExportWorkflow() {
    showConfirmDialog(
        'Export all properties to CSV? This may take a moment for large datasets.',
        'Confirm CSV Export',
        'Export CSV',
        'Cancel',
        'info'
    ).then(confirmed => {
        if (confirmed) {
            const progressToast = showProgressToast('Preparing CSV export...');
            
            setTimeout(() => {
                progressToast.updateMessage('Step 1: Querying database...');
                progressToast.updateProgress(25);
            }, 1000);
            
            setTimeout(() => {
                progressToast.updateMessage('Step 2: Formatting data...');
                progressToast.updateProgress(50);
            }, 2000);
            
            setTimeout(() => {
                progressToast.updateMessage('Step 3: Generating CSV...');
                progressToast.updateProgress(75);
            }, 3000);
            
            setTimeout(() => {
                progressToast.complete('CSV export completed successfully!', 'success');
                
                // Show toast with download action
                setTimeout(() => {
                    showToastWithAction(
                        'CSV exported successfully: zillow_properties_20241201.csv',
                        'success',
                        [
                            {
                                text: 'Download',
                                type: 'success',
                                onclick: 'showSuccessToast("Starting download...")'
                            }
                        ]
                    );
                }, 1000);
                
                addToHistory('Export workflow completed', 'success');
            }, 4000);
        } else {
            showInfoToast('CSV export was cancelled');
            addToHistory('Export workflow cancelled', 'info');
        }
    });
}

function demoBulkActionWorkflow() {
    showConfirmDialog(
        'Perform bulk action on 150 selected properties? This action cannot be undone.',
        'Confirm Bulk Action',
        'Perform Action',
        'Cancel',
        'warning'
    ).then(confirmed => {
        if (confirmed) {
            const progressToast = showProgressToast('Starting bulk operation...');
            
            let processed = 0;
            const total = 150;
            const interval = setInterval(() => {
                processed += 10;
                const progress = Math.round((processed / total) * 100);
                progressToast.updateMessage(`Processing properties... ${processed}/${total}`);
                progressToast.updateProgress(progress);
                
                if (processed >= total) {
                    clearInterval(interval);
                    progressToast.complete('Bulk operation completed successfully!', 'success');
                    addToHistory('Bulk action workflow completed', 'success');
                }
            }, 100);
        } else {
            showInfoToast('Bulk action was cancelled');
            addToHistory('Bulk action workflow cancelled', 'info');
        }
    });
}

function demoErrorHandlingWorkflow() {
    const progressToast = showProgressToast('Starting process...');
    
    setTimeout(() => {
        progressToast.updateMessage('Step 1: Initializing...');
        progressToast.updateProgress(25);
    }, 1000);
    
    setTimeout(() => {
        progressToast.updateMessage('Step 2: Processing...');
        progressToast.updateProgress(50);
    }, 2000);
    
    setTimeout(() => {
        progressToast.complete('Process failed: Network connection error', 'error');
        
        // Show toast with retry action
        setTimeout(() => {
            showToastWithAction(
                'Process failed due to a network error. Would you like to retry?',
                'error',
                [
                    {
                        text: 'Retry',
                        type: 'warning',
                        onclick: 'showWarningToast("Retrying process...")'
                    },
                    {
                        text: 'Report Issue',
                        type: 'info',
                        onclick: 'showInfoToast("Opening issue report form...")'
                    }
                ]
            );
        }, 1000);
        
        addToHistory('Error handling workflow completed', 'error');
    }, 3000);
}

function showCustomToast() {
    const message = document.getElementById('customMessage').value;
    const duration = parseInt(document.getElementById('customDuration').value);
    
    if (!message.trim()) {
        showErrorToast('Please enter a custom message');
        return;
    }
    
    showInfoToast(message, duration);
    addToHistory(`Custom toast: ${message}`, 'info');
}

// Override toast functions to add to history
const originalShowToast = window.showToast;
const originalShowSuccessToast = window.showSuccessToast;
const originalShowErrorToast = window.showErrorToast;
const originalShowWarningToast = window.showWarningToast;
const originalShowInfoToast = window.showInfoToast;

window.showToast = function(message, type, duration) {
    addToHistory(message, type);
    return originalShowToast(message, type, duration);
};

window.showSuccessToast = function(message, duration) {
    addToHistory(message, 'success');
    return originalShowSuccessToast(message, duration);
};

window.showErrorToast = function(message, duration) {
    addToHistory(message, 'error');
    return originalShowErrorToast(message, duration);
};

window.showWarningToast = function(message, duration) {
    addToHistory(message, 'warning');
    return originalShowWarningToast(message, duration);
};

window.showInfoToast = function(message, duration) {
    addToHistory(message, 'info');
    return originalShowInfoToast(message, duration);
};

// Show welcome toast when page loads
document.addEventListener('DOMContentLoaded', function() {
    showSuccessToast('Toast demo page loaded! Try out the different features below.');
    addToHistory('Demo page loaded', 'success');
});
</script>
{% endblock %}
