# Zillow Agent Messaging System

This system allows you to automatically send text messages to real estate agents using phone numbers extracted from CSV files generated by the Zillow property scraper.

## Features

- Loads CSV files from the `csv_outputs` directory
- Extracts agent phone numbers from the `Attribution_agentPhoneNumber` column
- Sends customizable text messages using Twilio
- Supports both environment variables and configuration file for Twilio credentials
- Handles phone number formatting and validation
- Provides detailed logging and summary reports

## Setup

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Twilio Account Setup

1. Sign up for a [Twilio account](https://www.twilio.com/)
2. Get your Account SID and Auth Token from the Twilio Console
3. Purchase a phone number for sending SMS messages

### 3. Configuration

You can configure Twilio credentials in two ways:

#### Option A: Environment Variables (Recommended for production)

```bash
export TWILIO_ACCOUNT_SID="your_account_sid_here"
export TWILIO_AUTH_TOKEN="your_auth_token_here"
export TWILIO_PHONE_NUMBER="+1234567890"
```

#### Option B: Configuration File

Edit `twilio_config.json` with your credentials:

```json
{
    "twilio": {
        "account_sid": "your_account_sid_here",
        "auth_token": "your_auth_token_here",
        "phone_number": "+1234567890"
    },
    "message": {
        "default_text": "Your custom message here"
    }
}
```

## Usage

### Basic Usage

```bash
python send_agent_messages.py
```

### What the Script Does

1. **Loads CSV Files**: Automatically finds and loads all CSV files from the `csv_outputs` directory
2. **Extracts Phone Numbers**: Looks for the `Attribution_agentPhoneNumber` column and extracts valid phone numbers
3. **Formats Phone Numbers**: Ensures phone numbers are in the correct format for Twilio (+1XXXXXXXXXX)
4. **Sends Messages**: Sends the configured message to each unique phone number
5. **Reports Results**: Provides a summary of successful and failed message sends

### Expected CSV Structure

Your CSV files should contain a column named `Attribution_agentPhoneNumber` with agent phone numbers. The script will automatically:

- Clean phone numbers (remove spaces, dashes, parentheses)
- Format them for US numbers (+1XXXXXXXXXX)
- Remove duplicates
- Validate format before sending

## File Structure

```
zillow/
├── csv_outputs/                    # Directory containing CSV files
│   ├── Single_family_houses_in_Los_Angeles.csv
│   └── Single_family_houses_in_San_Bernardino.csv
├── get_listing_and_agent.py        # Original Zillow scraper
├── send_agent_messages.py          # New Twilio messaging script
├── twilio_config.json              # Twilio configuration file
├── requirements.txt                 # Python dependencies
└── README.md                       # This file
```

## Customization

### Changing the Message

You can customize the message sent to agents by:

1. **Environment Variable**: Set `TWILIO_MESSAGE` environment variable
2. **Config File**: Update the `message.default_text` field in `twilio_config.json`
3. **Code**: Modify the default message in the `main()` function

### Phone Number Column

If your CSV uses a different column name for phone numbers, modify the `phone_column` parameter in the `extract_phone_numbers()` function call.

## Error Handling

The script includes comprehensive error handling for:

- Missing CSV files or directories
- Invalid phone number formats
- Twilio API errors
- Missing or invalid credentials
- File reading/writing errors

## Security Notes

- Never commit your Twilio credentials to version control
- Use environment variables in production environments
- Keep your `twilio_config.json` file secure and don't share it
- Consider using a `.env` file for local development

## Troubleshooting

### Common Issues

1. **"Twilio credentials not found"**
   - Check that environment variables are set correctly
   - Verify your `twilio_config.json` file exists and has correct format

2. **"No CSV files found"**
   - Ensure the `csv_outputs` directory exists
   - Check that CSV files have `.csv` extension

3. **"Column not found"**
   - Verify your CSV files contain the `Attribution_agentPhoneNumber` column
   - Check column name spelling and case

4. **"Invalid phone number"**
   - Phone numbers should be 10 digits (US format)
   - The script will automatically add +1 prefix

### Testing

Before sending messages to all agents, you can:

1. Create a test CSV with just a few phone numbers
2. Use a test Twilio account
3. Send to your own phone number first

## Support

For issues related to:
- **Twilio**: Check [Twilio documentation](https://www.twilio.com/docs)
- **Script functionality**: Review error messages and check file paths
- **Phone number formatting**: Verify CSV column structure

